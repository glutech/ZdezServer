package cn.com.zdez.cache;

import java.util.HashMap;
import java.util.List;
import java.util.concurrent.ConcurrentHashMap;

import redis.clients.jedis.Jedis;

import cn.com.zdez.dao.RedisConnection;
import cn.com.zdez.service.SchoolMsgService;
import cn.com.zdez.vo.SchoolMsgVo;

public class SchoolMsgCache {

	public void cacheSchoolMsg(List<SchoolMsgVo> list) {
		Jedis jedis = new RedisConnection().getConnection();
	    for(int i=0, count=list.size(); i<count; i++) {
	    	jedis.sadd("schoolMsg:idList", Integer.toString(list.get(i).getSchoolMsgId()));
	    	ConcurrentHashMap<String, String> map = new ConcurrentHashMap<String, String>();
	    	map.put("id", Integer.toString(list.get(i).getSchoolMsgId()));
	    	map.put("title", list.get(i).getTitle());
	    	map.put("cover", new SchoolMsgService().getCoverPath(list.get(i).getContent()));
	    	map.put("content", list.get(i).getContent());
	    	map.put("date", list.get(i).getDate().toString());
	    	map.put("schoolName", list.get(i).getSchoolName());
	    	map.put("senderName", list.get(i).getSenderName());
	    	map.put("destGrade", "destGrade:" + list.get(i).getSchoolMsgId());
	    	map.put("destMajor", "destMajor:" + list.get(i).getSchoolMsgId());
	    	map.put("destDepartment", "destDepartment:" + list.get(i).getSchoolMsgId());
	    	jedis.hmset("schoolMsg:" + list.get(i).getSchoolMsgId(), map);
	    	
	    	for(int n=0, count2=list.get(i).getDestGrade().size(); n<count2; n++) {
	    		jedis.sadd("destGrade:" + list.get(i).getSchoolMsgId(), list.get(i).getDestGrade().get(n));
	    	}
	    	
	    	for(int p=0, count3=list.get(i).getDestMajor().size(); p<count3; p++) {
	    		jedis.sadd("destMajor:" + list.get(i).getSchoolMsgId(), list.get(i).getDestMajor().get(p));
	    	}
	    	
	    	for(int q=0, count4=list.get(i).getDestDepartment().size(); q<count4; q++) {
	    		jedis.sadd("destDepartment:" + list.get(i).getSchoolMsgId(), list.get(i).getDestDepartment().get(q));
	    	}
	    }
	}
}
