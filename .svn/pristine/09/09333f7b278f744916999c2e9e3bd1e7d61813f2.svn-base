package cn.com.zdez.service;

import java.util.ArrayList;
import java.util.List;

import cn.com.zdez.dao.NewsDao;
import cn.com.zdez.po.News;
import cn.com.zdez.vo.NewsVo;

public class NewsService {

	NewsDao dao = new NewsDao();

	public synchronized boolean newNews(News n, List<Integer> destUsers) {
		boolean flag = false;
		if (dao.newNews(n)) {
			int newsId = dao.getLatestNewsId();
			if (dao.newNews_Receivers(newsId, destUsers)) {
				flag = true;
				// 是否要写入缓存？
			} else {
				this.roll_back(newsId);
			}
		}
		return flag;
	}

	public void roll_back(int newsId) {
		dao.deleteReceivers(newsId);
		dao.deleteNews(newsId);
	}

	/**
	 * @param stuId
	 * @return
	 */
	public List<NewsVo> getNewsToUpdate(int stuId) {
		return dao.getNewsToUpdate(stuId);
	}

	public void updateNewsReceived(int stuId, String[] newsIdArray) {
		List<Integer> newsIdList = new ArrayList<Integer>();
		for (int i = 0, count = newsIdArray.length; i < count; i++) {
			newsIdList.add(Integer.parseInt(newsIdArray[i]));
		}
		dao.updateNewsReceived(stuId, newsIdList);
	}

}
